{"version":3,"file":"ConnectionFactory.js","names":["stores","version","dbName","connection","close","ConnectionFactory","Error","Promise","resolve","reject","openRequest","window","indexedDB","open","onupgradeneeded","e","_createStores","target","result","onsuccess","bind","onerror","console","log","error","name","forEach","store","objectStoreNames","contains","deleteObjectStore","createObjectStore","autoIncrement"],"sources":["../../app-es6/services/ConnectionFactory.js"],"sourcesContent":["\r\nconst stores = ['negociacoes'];\r\nconst version = 4;\r\nconst dbName = 'aluraframe';\r\n\r\nlet connection = null;\r\nlet close = null;\r\n\r\n\r\nexport class ConnectionFactory {\r\n\r\n    constructor(){\r\n      throw new Error('A classe não pode ser instânciada');\r\n    }\r\n\r\n    static getConnection() {\r\n      return new Promise((resolve,reject) => {\r\n          let openRequest = window.indexedDB.open(dbName, version);\r\n\r\n          openRequest.onupgradeneeded = e => {\r\n                  ConnectionFactory._createStores(e.target.result)\r\n          };\r\n\r\n          openRequest.onsuccess = e => {\r\n              if(!connection) {\r\n                  connection = e.target.result;\r\n                  close = connection.close.bind(connection);\r\n                  connection.close = () => {\r\n                    throw new Error('Você não pode fechar diretamene a conexão')\r\n                  }\r\n                  }\r\n              resolve(connection);\r\n          };\r\n\r\n          openRequest.onerror = e => {\r\n              console.log(e.target.error)\r\n\r\n              reject(e.target.error.name)\r\n          };\r\n      });\r\n    };\r\n\r\n    static _createStores(connection){\r\n      stores.forEach(store => {\r\n        if(connection.objectStoreNames.contains(store)) \r\n          connection.deleteObjectStore(store);\r\n\r\n        connection.createObjectStore(store, {autoIncrement: true});\r\n        })\r\n    }\r\n\r\n    static closeConnection(){\r\n\r\n          if(connection) {\r\n            close();\r\n            connection = null;\r\n          }\r\n    }\r\n\r\n}\r\n     "],"mappings":";;;;;;;;;;;;;;;;MACMA,M,GAAS,CAAC,aAAD,C;MACTC,O,GAAU,C;MACVC,M,GAAS,Y;MAEXC,U,GAAa,I;MACbC,K,GAAQ,I;;mCAGCC,iB;QAET,6BAAa;UAAA;;UACX,MAAM,IAAIC,KAAJ,CAAU,mCAAV,CAAN;QACD;;;;iBAED,yBAAuB;YACrB,OAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAoB;cACnC,IAAIC,WAAW,GAAGC,MAAM,CAACC,SAAP,CAAiBC,IAAjB,CAAsBX,MAAtB,EAA8BD,OAA9B,CAAlB;;cAEAS,WAAW,CAACI,eAAZ,GAA8B,UAAAC,CAAC,EAAI;gBAC3BV,iBAAiB,CAACW,aAAlB,CAAgCD,CAAC,CAACE,MAAF,CAASC,MAAzC;cACP,CAFD;;cAIAR,WAAW,CAACS,SAAZ,GAAwB,UAAAJ,CAAC,EAAI;gBACzB,IAAG,CAACZ,UAAJ,EAAgB;kBACZA,UAAU,GAAGY,CAAC,CAACE,MAAF,CAASC,MAAtB;kBACAd,KAAK,GAAGD,UAAU,CAACC,KAAX,CAAiBgB,IAAjB,CAAsBjB,UAAtB,CAAR;;kBACAA,UAAU,CAACC,KAAX,GAAmB,YAAM;oBACvB,MAAM,IAAIE,KAAJ,CAAU,2CAAV,CAAN;kBACD,CAFD;gBAGC;;gBACLE,OAAO,CAACL,UAAD,CAAP;cACH,CATD;;cAWAO,WAAW,CAACW,OAAZ,GAAsB,UAAAN,CAAC,EAAI;gBACvBO,OAAO,CAACC,GAAR,CAAYR,CAAC,CAACE,MAAF,CAASO,KAArB;gBAEAf,MAAM,CAACM,CAAC,CAACE,MAAF,CAASO,KAAT,CAAeC,IAAhB,CAAN;cACH,CAJD;YAKH,CAvBM,CAAP;UAwBD;;;iBAED,uBAAqBtB,UAArB,EAAgC;YAC9BH,MAAM,CAAC0B,OAAP,CAAe,UAAAC,KAAK,EAAI;cACtB,IAAGxB,UAAU,CAACyB,gBAAX,CAA4BC,QAA5B,CAAqCF,KAArC,CAAH,EACExB,UAAU,CAAC2B,iBAAX,CAA6BH,KAA7B;cAEFxB,UAAU,CAAC4B,iBAAX,CAA6BJ,KAA7B,EAAoC;gBAACK,aAAa,EAAE;cAAhB,CAApC;YACC,CALH;UAMD;;;iBAED,2BAAwB;YAElB,IAAG7B,UAAH,EAAe;cACbC,KAAK;cACLD,UAAU,GAAG,IAAb;YACD;UACN"}